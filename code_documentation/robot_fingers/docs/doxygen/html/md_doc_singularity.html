<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>robot_fingers: About Singularity</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">robot_fingers
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_doc_singularity.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">About Singularity </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>What is Singularity? </h2>
<p>Singularity is a tool to run software inside containers, similar to Docker. Compared to Docker it has a higher focus on security and can be used without root permission. Also programs in the container are executed as the user of the host system which makes it much more convenient when touching files of the host system (as it is happening when building a mounted workspace).</p>
<h2>Get our Singularity Image </h2>
<p>We provide a Singularity image with Ubuntu 18.04 with all dependencies needed to build and run the software here:</p>
<ul>
<li><a href="https://drive.google.com/file/d/1yJ_RI1GpnPcs_fxcNYYUXZtQPHvhlGNH/view?usp=sharing">Download Singularity Image</a></li>
</ul>
<h2>Install Singularity </h2>
<p>We are using Singularity version 3.6. Other recent versions are probably also so fine, however, we cannot guarantee compatibility for those. Unfortunately, most versions of Ubuntu still provide Singularity version 2.x in their official repositories. A newer version can be installed from source in this case. For this you may follow the <a href="https://sylabs.io/guides/3.6/user-guide/quick_start.html#quick-installation-steps">official installation instructions</a> or use the following, slightly simplified instructions (assuming you are working with Ubuntu).</p>
<p>Install system dependencies: </p><pre class="fragment">$ sudo apt-get update &amp;&amp; sudo apt-get install -y \
    build-essential \
    libssl-dev \
    uuid-dev \
    libgpgme11-dev \
    squashfs-tools \
    libseccomp-dev \
    wget \
    pkg-config \
    git \
    cryptsetup
</pre><p>Get the required version of the Go compiler: </p><pre class="fragment">cd ~/Downloads  # you can save it anywhere else, just adjust paths below
wget https://dl.google.com/go/go1.13.linux-amd64.tar.gz
tar -xzf go1.13.linux-amd64.tar.gz
</pre><p>Note that it is only needed once for building singularity, so no need to install it permanently (we just add it to PATH temporarily for building, see below).</p>
<p>Now download and unpack the singularity source: </p><pre class="fragment">wget https://github.com/sylabs/singularity/releases/download/v3.6.1/singularity-3.6.1.tar.gz
tar -xzf singularity-3.6.1.tar.gz
</pre><p>And finally build and install it: </p><pre class="fragment">export PATH=~/Downloads/go/bin:${PATH}  # adjust path if you used a different directory
cd singularity  # the folder to which the singularity source was extracted
./mconfig
cd builddir
make
sudo make install
</pre><p>Now you should be able to use Singularity. You can test this, for example, by running <code>singularity --version</code> which should print "singularity version 3.6.1". For more information on how to use Singularity, see the <a href="https://sylabs.io/guides/3.6/user-guide/index.html">official documentation</a>.</p>
<h2>Run Something in the Container </h2>
<p>To run the container in shell mode (i.e. opening a shell inside the container), the following is often enough: </p><pre class="fragment">singularity shell path/to/image.sif
</pre><p>This will, however, be influenced by your local setup as environment variables are exported and the home directory is mounted by default. Further the current working directory from which singularity is run is also bound inside the container.</p>
<p>This default behaviour is often convenient but can cause issues in some cases. A typical example would be a Python package installed in your home directory (which will then be available in the container) which is not compatible with versions of other packages inside the container. To avoid these kind of issues it is recommended to use the following command to run the container in a more isolated way: </p><pre class="fragment">export SINGULARITYENV_DISPLAY=$DISPLAY
singularity shell -e --no-home -B $(pwd) path/to/image.sif
</pre><p>The arguments explained:</p>
<ul>
<li>The first line makes sure the DISPLAY environment variable is set correctly inside the container (only needed if you want to run GUI-based applications).</li>
<li><code>-e</code> (short for <code>--cleanenv</code>) prevents environment variables to be exported.</li>
<li><code>--no-home</code> prevents your home directory from being bound.</li>
<li><code>-B </code> explicitly binds the current working directory. This should normally not be necessary but Singularity 3.6 seems to have a bug that the PWD is not bound automatically if it is somewhere inside your home directory and <code>--no-home</code> is used.</li>
</ul>
<p>Note that with the above the current working directory is still bound in the image, so it is possible to build/modify the workspace from the host-system when Singularity is run from the root directory of the workspace.</p>
<h3>Compatibility with Nvidia Drivers</h3>
<p>When you are using Nvidia drivers and want to run a GUI-based application in the container, you may need to add the <code>--nv</code> flag: </p><pre class="fragment">singularity shell --nv ... path/to/image.sif
</pre><h2>Add Custom Dependencies to the Container </h2>
<p>The image we provide already includes everything needed to run the robot and the simulation. However, you may need additional libraries to use them in our own code, which are not yet present. In this case, you can create your own image which is based on our standard image but extends it with your additional dependencies.</p>
<p>To extend the image, create <em>definition file</em> like the following: </p><pre class="fragment"># Specify the name of the base image below
Bootstrap: localimage
From: ./base_image.sif

%post
    # Put commands to install additional dependencies here.
    # Make sure everything runs automatically without human input (e.g. add
    # `-y` to automatically say "yes" below).
    apt-get install -y package_name
</pre><p>See the official <a href="https://sylabs.io/guides/3.6/user-guide/definition_files.html">Documentation for Definition Files</a> for all options in the definition file.</p>
<p>Assuming you called your definition file <code>user_image.def</code>, use the following command to build the image. Note that the base image (specified in the <code>From:</code> line) needs to be present in the directory in which you call the command. </p><pre class="fragment">$ singularity build --fakeroot user_image.sif path/to/user_image.def</pre> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
